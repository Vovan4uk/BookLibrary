<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemalocation="http://www.liquibase.org/xml/ns/dbchangelog
                   http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.0.xsd">
    <changeSet author="vperep" id="1">

        <createTable tableName="BOOK">
            <column name="ID" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="NAME" type="VARCHAR(40)">
                <constraints nullable="false"/>
            </column>
            <column name="PUBLISHED_DATE" type="DATE">
                <constraints nullable="false"/>
            </column>
            <column name="ISBN" type="VARCHAR(20)">
                <constraints nullable="false"/>
            </column>
            <column name="PUBLISHER" type="VARCHAR(40)">
                <constraints nullable="false"/>
            </column>
            <column name="BOOK_CREATE" type="DATE">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <addPrimaryKey tableName="BOOK" constraintName="BOOK_PK" columnNames="ID"/>

        <createIndex tableName="BOOK" indexName="BOOK_UK1" unique="true">
            <column name="ISBN"/>
        </createIndex>

        <createTable tableName="REVIEW">
            <column name="ID" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="COMMENTER_NAME" type="VARCHAR(40)">
                <constraints nullable="false"/>
            </column>
            <column name="COMMENT_BODY" type="CLOB(0)">
                <constraints nullable="false"/>
            </column>
            <column name="COMMENT_RATING" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="COMMENT_CREATE" type="DATE">
                <constraints nullable="false"/>
            </column>
            <column name="BOOK_ID" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <addPrimaryKey tableName="REVIEW" constraintName="REVIEW_PK" columnNames="ID"/>

        <createTable tableName="AUTHOR">
            <column name="ID" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="FIRST_NAME" type="VARCHAR(20)">
                <constraints nullable="false"/>
            </column>
            <column name="SECOND_NAME" type="VARCHAR(20)">
                <constraints nullable="false"/>
            </column>
            <column name="AUTHOR_CREATE" type="DATE">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <addPrimaryKey tableName="AUTHOR" constraintName="AUTHOR_PK" columnNames="ID"/>

        <createTable tableName="BOOK_AUTHOR">
            <column name="BOOK_ID" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="AUTHOR_ID" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <addForeignKeyConstraint baseTableName="BOOK_AUTHOR" constraintName="BOOK_AUTHOR_FK1" baseColumnNames="BOOK_ID" referencedTableName="BOOK" referencedColumnNames="ID" onDelete="RESTRICT" onUpdate="CASCADE"/>

        <addForeignKeyConstraint baseTableName="REVIEW" constraintName="REVIEW_FK1" baseColumnNames="BOOK_ID" referencedTableName="BOOK" referencedColumnNames="ID" onDelete="RESTRICT" onUpdate="CASCADE"/>

        <addForeignKeyConstraint baseTableName="BOOK_AUTHOR" constraintName="BOOK_AUTHOR_FK2" baseColumnNames="AUTHOR_ID" referencedTableName="AUTHOR" referencedColumnNames="ID" onDelete="RESTRICT" onUpdate="CASCADE"/>


        <rollback>
            <dropTable tableName="BOOK"/>
            <dropTable tableName="AUTHOR"/>
            <dropTable tableName="REVIEW"/>
            <dropTable tableName="BOOK_AUTHOR"/>
        </rollback>

    </changeSet>

</databaseChangeLog>